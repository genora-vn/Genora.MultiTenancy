@page
@using Genora.MultiTenancy.Localization
@using Genora.MultiTenancy.Web.Pages.AppMembershipTiers
@using Microsoft.Extensions.Localization
@using Volo.Abp.AspNetCore.Mvc.UI.Bootstrap.TagHelpers.Modal
@model CreateModalModel
@inject IStringLocalizer<MultiTenancyResource> L
@{
    Layout = null;
}
<form abp-model="MembershipTier" asp-page="/AppMembershipTiers/CreateModal">
    <abp-modal>
        <abp-modal-header title="@L["CreateAppMembershipTier"].Value"></abp-modal-header>
        <abp-modal-body>
            @* <abp-form-content /> *@
            <abp-input asp-for="MembershipTier.Code" placeholder="Nhập mã hạng (vd: GOLD)" />
            <abp-input asp-for="MembershipTier.Name" placeholder="Nhập tên" />
            <div class="mb-3">
                <label asp-for="MembershipTier.Description" class="form-label"></label>
                <textarea asp-for="MembershipTier.Description" placeholder="Mô tả chi tiết xếp hạng" rows="4" class="form-control"></textarea>
            </div>
            <abp-input asp-for="MembershipTier.MinTotalSpending" placeholder="Nhập doanh thu tối thiểu" />
            <abp-input asp-for="MembershipTier.MinRounds" placeholder="Nhập lượi chơi tối thiểu" />
            <abp-input asp-for="MembershipTier.EvaluationPeriod" placeholder="Chu kỳ xét tăng hạng" />
            <abp-input asp-for="MembershipTier.Benefits" placeholder="Nhập quyền lợi của khách hàng đạt rank" />
            <div class="group d-inline-flex" style="width: 100%">
                <div class="col-md-8">
                    <abp-input asp-for="MembershipTier.DisplayOrder" />
                </div>
                <div class="col-md-4" style="display:flex; align-items: anchor-center; margin-left: 10px">
                    <abp-input asp-for="MembershipTier.IsActive" />
                </div>
            </div>
        </abp-modal-body>
        <abp-modal-footer buttons="@(AbpModalButtons.Cancel | AbpModalButtons.Save)"></abp-modal-footer>
    </abp-modal>
</form>
<script>
    document.querySelector('input[name="MembershipTier.MinTotalSpending"]').classList.add('thousand-separator');
    // Thêm định dạng dấu chấm ngăn cách hàng nghìn cho các input có class 'thousand-separator'
    document.querySelectorAll('.thousand-separator').forEach(function(input) {
        // Format khi load trang (display)
        if (input.value) {
            let num = parseFloat(input.value);
            if (!isNaN(num)) {
                input.value = num.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 }).replace(/,/g, '.');
            }
        }

        // Format khi user nhập (on input)
        input.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\./g, ''); // Xóa dấu chấm cũ
            let num = parseFloat(value);
            if (!isNaN(num)) {
                e.target.value = num.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 }).replace(/,/g, '.');
            } else if (value === '') {
                e.target.value = '';
            }
        });

        // Khi submit form, chuyển về dạng số thuần để model binding decimal hoạt động
        input.closest('form').addEventListener('submit', function() {
            input.value = input.value.replace(/\./g, '');
        });
    });
</script>